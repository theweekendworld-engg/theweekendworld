generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id               String            @id @default(cuid())
  slug             String            @unique
  name             String
  description      String            @db.Text
  shortDescription String?
  featuredImage    String?
  gallery          Json? // Array of image URLs
  videoUrl         String?
  githubUrl        String?
  liveUrl          String?
  features         Json? // Array of feature objects
  tags             String[]          @default([])
  published        Boolean           @default(false)
  featured         Boolean           @default(false)
  order            Int               @default(0)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  testimonials     Testimonial[]
  interests        ProductInterest[]

  @@index([slug])
  @@index([published])
  @@index([featured])
}

model Testimonial {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  author    String
  role      String?
  company   String?
  content   String   @db.Text
  avatar    String?
  rating    Int?     @default(5)
  createdAt DateTime @default(now())

  @@index([productId])
}

model BlogPost {
  id         String        @id @default(cuid())
  slug       String        @unique
  title      String
  excerpt    String?       @db.Text
  content    String        @db.Text
  coverImage String?
  author     String        @default("TheWeekendWorld")
  category   String?
  tags       String[]      @default([])
  published  Boolean       @default(false)
  featured   Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  likes      BlogLike[]
  comments   BlogComment[]

  @@index([slug])
  @@index([published])
  @@index([category])
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([read])
  @@index([createdAt])
}

model SiteSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
}

model AdminUser {
  id           String    @id @default(cuid())
  username     String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  lastLogin    DateTime?

  @@index([username])
}

model BlogLike {
  id             String   @id @default(cuid())
  blogPostId     String
  blogPost       BlogPost @relation(fields: [blogPostId], references: [id], onDelete: Cascade)
  userIdentifier String // IP address hash or session ID
  createdAt      DateTime @default(now())

  @@unique([blogPostId, userIdentifier])
  @@index([blogPostId])
  @@index([createdAt])
}

model BlogComment {
  id             String        @id @default(cuid())
  blogPostId     String
  blogPost       BlogPost      @relation(fields: [blogPostId], references: [id], onDelete: Cascade)
  content        String        @db.Text
  authorName     String? // Display name (can be "Anonymous" or custom name)
  email          String? // Optional email (for notifications/replies)
  isAnonymous    Boolean       @default(false)
  approved       Boolean       @default(true) // Auto-approve, admin can moderate
  userIdentifier String? // IP hash for spam prevention
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  parentId       String?
  parent         BlogComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies        BlogComment[] @relation("CommentReplies")

  @@index([blogPostId])
  @@index([parentId])
  @@index([approved])
  @@index([createdAt])
}

model ProductInterest {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String
  email     String
  message   String?  @db.Text // Optional message/use case
  status    String   @default("pending") // pending, contacted, closed
  notes     String?  @db.Text // Admin notes
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  read      Boolean  @default(false)

  @@index([productId])
  @@index([status])
  @@index([read])
  @@index([createdAt])
}

model WeekendPick {
  id           String   @id @default(cuid())
  title        String
  description  String   @db.Text
  imageUrl     String?
  category     String?
  linkUrl      String?
  order        Int      @default(0)
  active       Boolean  @default(true)
  weekStartDate DateTime // Date when this pick's week starts (typically Friday)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([active])
  @@index([order])
  @@index([weekStartDate])
}

model WeekendStory {
  id        String   @id @default(cuid())
  photoUrl  String
  caption   String   @db.Text
  authorName String?
  approved  Boolean  @default(false)
  featured  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([approved])
  @@index([featured])
  @@index([createdAt])
}

model VibeRecommendation {
  id          String   @id @default(cuid())
  vibe        String   // chill, party, travel, build
  title       String
  description String   @db.Text
  linkUrl     String?
  emoji       String?
  active      Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([vibe])
  @@index([active])
  @@index([order])
}
